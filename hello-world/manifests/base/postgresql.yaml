apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLServer
metadata:
  name: postgresqlserver-hello-world
  namespace: hello-world
spec:
  location: westeurope
  serverVersion: "10"
  sslEnforcement: Enabled
  sku:
    name: B_Gen5_2
    tier: Basic
    family: Gen5
    size: "51200"
    capacity: 2
  # Use the field below to optionally specify a different keyvault
  # to store the server admin credential secrets in
  #keyVaultToStoreSecrets: asoSecretKeyVault
---
apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLDatabase
metadata:
  name: postgresqldatabase-hello-world
  namespace: hello-world
spec:
  server: postgresqlserver-hello-world
---
apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLFirewallRule
metadata:
  name: postgresqlfirewallrule-hello-world
  namespace: hello-world
spec:
  server: postgresqlserver-hello-world
  # FIXME: make this not open to the entire world
  startIpAddress: 0.0.0.0
  endIpAddress: 0.0.0.0
---
# https://github.com/Azure/azure-service-operator/blob/217c62e5f65c94b753fa62c9a87eda210c1a8e5f/config/samples/azure_v1alpha1_postgresqluser.yaml
apiVersion: azure.microsoft.com/v1alpha1
kind: PostgreSQLUser
metadata:
  name: psqluser-hello-world
  namespace: hello-world
spec:
  server: postgresqlserver-hello-world
  dbName: postgresqldatabase-hello-world
  # The Azure Database for PostgreSQL server is created with the 3 default roles defined.
  # azure_pg_admin
  # azure_superuser
  # your server admin user
  roles:
    - "azure_pg_admin"
    # Specify a specific username for the user
  username: psqluser-hello-world
  # Specify adminSecret and adminSecretKeyVault if you want to
  # read the PSQL server admin creds from a specific keyvault secret
  # adminSecret: postgresqlserver-hello-world
  # adminSecretKeyVault: asokeyvault
  # Use the field below to optionally specify a different keyvault
  # to store the secrets in
  # keyVaultToStoreSecrets: asokeyvault
